(()=>{"use strict";var e,t={453:()=>{function e(e,t,i,s,r,n,a,o){var l,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=i,c._compiled=!0),s&&(c.functional=!0),n&&(c._scopeId="data-v-"+n),a?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},c._ssrRegister=l):r&&(l=o?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),l)if(c.functional){c._injectStyles=l;var u=c.render;c.render=function(e,t){return l.call(t),u(e,t)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,l):[l]}return{exports:e,options:c}}const t=e({name:"file-uploader-directory",props:{path:{type:String,required:!0},directory:{type:Object,required:!0},root:{type:Boolean,default:!1},removable:{type:Boolean,default:!1}},data:function(){return{collapsed:!1}},computed:{classObject:function(){return{selected:this.directory.selected,root:this.root}},hasItems:function(){return this.directory.files.length>0||Object.keys(this.directory.directories).length>0}},methods:{emitSelect:function(e){this.$emit("select",e)},emitUnselect:function(e){this.$emit("unselect",e)},handleClick:function(){this.directory.selected?this.emitUnselect(this.directory):this.emitSelect(this.directory)},emitRemoveDirectory:function(e,t){t=t?this.root?"/".concat(t):"".concat(this.path,"/").concat(t):this.path,this.$emit("remove-directory",e,t)},handleRemoveDirectory:function(){this.removable&&this.emitRemoveDirectory(this.directory)},emitRemoveFile:function(e,t){t=t?this.root?"/".concat(t):"".concat(this.path,"/").concat(t):this.path,this.$emit("remove-file",e,t)},handleRemoveFile:function(e){this.removable&&this.emitRemoveFile(e)},handleCollapse:function(){this.collapsed=!0},handleUncollapse:function(){this.collapsed=!1}},watch:{hasItems:function(e){e||(this.collapsed=!1)}}},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"storage-file-uploader-directory",class:e.classObject},[e.root?e._e():i("div",{staticClass:"storage-file-uploader-directory-name clearfix",on:{click:e.handleClick}},[e.collapsed?i("i",{staticClass:"fa fa-angle-right fa-fw",attrs:{title:"Expand this directory"},on:{click:function(t){return t.stopPropagation(),e.handleUncollapse.apply(null,arguments)}}}):i("i",{staticClass:"fa fa-angle-down fa-fw",attrs:{title:"Collapse this directory"},on:{click:function(t){return t.stopPropagation(),e.handleCollapse.apply(null,arguments)}}}),e._v(" "),i("i",{staticClass:"fa fa-folder"}),e._v(" "),i("span",{domProps:{textContent:e._s(e.path)}}),e._v(" "),e.removable?i("button",{staticClass:"btn btn-default btn-xs pull-right",attrs:{title:"Remove the directory"},on:{click:function(t){return t.stopPropagation(),e.handleRemoveDirectory.apply(null,arguments)}}},[i("i",{staticClass:"fa fa-trash"})]):e._e()]),e._v(" "),i("ul",{directives:[{name:"show",rawName:"v-show",value:!e.collapsed,expression:"!collapsed"}],staticClass:"storage-file-uploader-directory-list"},[e._l(e.directory.directories,(function(t,s){return i("li",[i("file-uploader-directory",{attrs:{path:s,directory:t,removable:e.removable},on:{select:e.emitSelect,unselect:e.emitUnselect,"remove-directory":e.emitRemoveDirectory,"remove-file":e.emitRemoveFile}})],1)})),e._v(" "),e._l(e.directory.files,(function(t){return i("li",{staticClass:"storage-file-uploader-file clearfix"},[i("i",{staticClass:"fa fa-file"}),e._v(" "),i("span",{domProps:{textContent:e._s(t.name)}}),e._v(" "),e.removable?i("button",{staticClass:"btn btn-default btn-xs pull-right",attrs:{title:"Remove the file"},on:{click:function(i){return i.stopPropagation(),e.handleRemoveFile(t)}}},[i("i",{staticClass:"fa fa-trash"})]):e._e()])})),e._v(" "),e.hasItems?e._e():i("li",{staticClass:"storage-file-uploader-file text-muted",attrs:{title:"This directory is empty"}},[e._v("\n            (empty)\n        ")])],2)])}),[],!1,null,null,null).exports,i=Vue.resource("api/v1/storage-requests{/id}",{},{approve:{method:"POST",url:"api/v1/storage-requests{/id}/approve"},reject:{method:"POST",url:"api/v1/storage-requests{/id}/reject"},extend:{method:"POST",url:"api/v1/storage-requests{/id}/extend"}});var s=biigle.$require("messages").handleErrorResponse,r=biigle.$require("core.mixins.loader"),n=function(e){var t="",i=["kB","MB","GB","TB"];do{e/=1e3,t=i.shift()}while(e>1e3&&i.length>0);return"".concat(e.toFixed(2)," ").concat(t)};var a=e({mixins:[r],props:{accept:{type:String,default:""},maxSize:{type:Number,default:-1}},components:{directory:t},data:function(){return{files:[],rootDirectory:{name:"",directories:{},files:[],selected:!1},selectedDirectory:null,currentUploadedSize:0,finishedUploadedSize:0,finished:!1,storageRequest:null}},computed:{hasSelectedDirectory:function(){return null!==this.selectedDirectory},selectedDirectoryName:function(){return this.selectedDirectory.name},hasItems:function(){return Object.keys(this.rootDirectory.directories).length>0},hasFiles:function(){return this.files.length>0},totalSize:function(){return this.files.reduce((function(e,t){return e+t.size}),0)},totalSizeForHumans:function(){return n(this.totalSize)},uploadedSize:function(){return this.currentUploadedSize+this.finishedUploadedSize},uploadedPercent:function(){return Math.round(this.uploadedSize/this.totalSize*100)},uploadedSizeForHumans:function(){return n(this.uploadedSize)},editable:function(){return!this.loading&&!this.finished},exceedsMaxSize:function(){return-1!==this.maxSize&&this.totalSize>this.maxSize},canSubmit:function(){return this.hasFiles&&!this.exceedsMaxSize},maxSizeForHumans:function(){return n(this.maxSize)}},methods:{handleFilesChosen:function(e){if(this.hasSelectedDirectory){var t=e.target.files,i=this.selectedDirectory.files,s=0,r=[];for(s=0;s<t.length;s++)r.push(t[s].name);for(s=i.length;s--;)r.includes(i[s].name)&&i.splice(s,1);for(s=0;s<t.length;s++)i.push(t[s]);this.syncFiles()}},handleNewDirectory:function(e){var t,i=this.rootDirectory.directories;this.hasSelectedDirectory&&(i=this.selectedDirectory.directories,this.selectedDirectory.selected=!1),e.split("/").forEach((function(e){i.hasOwnProperty(e)||(t=Vue.set(i,e,{name:e,directories:{},files:[],selected:!1})),i=i[e].directories})),t.selected=!0,this.selectedDirectory=t},addDirectory:function(){var e=prompt("Please enter the new directory name");e&&this.handleNewDirectory(e)},addFiles:function(){this.$refs.fileInput.click()},selectDirectory:function(e){this.hasSelectedDirectory&&(this.selectedDirectory.selected=!1),this.selectedDirectory=e,this.selectedDirectory.selected=!0},unselectDirectory:function(){this.hasSelectedDirectory&&(this.selectedDirectory.selected=!1,this.selectedDirectory=null)},removeDirectory:function(e,t){var i=this.rootDirectory.directories;t.split("/").slice(1,-1).forEach((function(e){i=i[e].directories})),Vue.delete(i,e.name),e.selected&&(this.selectedDirectory=null),this.syncFiles()},removeFile:function(e,t){var i=this.rootDirectory;t.split("/").slice(1).forEach((function(e){i=i.directories[e]}));var s=i.files,r=s.indexOf(e);-1!==r&&s.splice(r,1),this.syncFiles()},extractFiles:function(e,t){t=t?"".concat(t,"/").concat(e.name):e.name;var i=[];for(var s in e.directories)i=i.concat(this.extractFiles(e.directories[s],t));return i.concat(e.files.map((function(e){return{prefix:t,size:e.size,file:e}})))},syncFiles:function(){this.files=this.extractFiles(this.rootDirectory)},handleSubmit:function(){this.canSubmit&&(this.startLoading(),(this.storageRequest?Promise.resolve({body:this.storageRequest}):i.save()).then(this.proceedWithUpload).then(this.finishSubmission).catch(s).finally(this.finishLoading))},proceedWithUpload:function(e){return this.storageRequest=e.body,this.uploadAllFiles()},uploadAllFiles:function(){var e=this,t=this.files.slice();return function i(){if(0!==t.length)return e.uploadFile(t.shift()).then(i)}()},uploadFile:function(e){var t=this,i="api/v1/storage-requests/".concat(this.storageRequest.id,"/files"),s=new FormData;return s.append("file",e.file),s.append("prefix",e.prefix),this.$http.post(i,s,{uploadProgress:this.updateCurrentUploadedSize}).then((function(){t.currentUploadedSize=0,t.finishedUploadedSize+=e.file.size}))},updateCurrentUploadedSize:function(e){e.lengthComputable&&(this.currentUploadedSize=e.loaded)},finishSubmission:function(){var e=this;return i.update({id:this.storageRequest.id},{}).then((function(){return e.finished=!0}))}}},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"storage-file-uploader"},[i("input",{ref:"fileInput",staticClass:"hidden",attrs:{type:"file",multiple:"",accept:e.accept},on:{input:e.handleFilesChosen}}),e._v(" "),e.finished?e._e():i("div",{staticClass:"storage-file-uploader-buttons"},[e.loading?i("div",{staticClass:"text-info"},[i("loader",{attrs:{active:!0}}),e._v("\n            Uploaded "),i("span",{domProps:{textContent:e._s(e.uploadedSizeForHumans)}}),e._v(" of "),i("span",{domProps:{textContent:e._s(e.totalSizeForHumans)}}),e._v("\n            ("),i("span",{domProps:{textContent:e._s(e.uploadedPercent)}}),e._v("%)\n        ")],1):i("div",[i("button",{staticClass:"btn btn-default",attrs:{title:"Add a new directory"},on:{click:e.addDirectory}},[i("i",{staticClass:"fa fa-folder"}),e._v(" Add directory\n            ")]),e._v(" "),e.hasSelectedDirectory?i("button",{staticClass:"btn btn-default",attrs:{title:"Add new files"},on:{click:e.addFiles}},[i("i",{staticClass:"fa fa-file"}),e._v(" Add files\n            ")]):i("button",{staticClass:"btn btn-default",attrs:{title:"Please create or select a directory to add files to",disabled:""}},[i("i",{staticClass:"fa fa-file"}),e._v(" Add files\n            ")]),e._v(" "),i("span",{staticClass:"pull-right"},[e.hasFiles?i("button",{staticClass:"btn btn-success",attrs:{title:"Submit the storage request and upload the files",disabled:e.exceedsMaxSize},on:{click:e.handleSubmit}},[i("i",{staticClass:"fa fa-upload"}),e._v(" Submit\n                    "),i("span",{domProps:{textContent:e._s(e.totalSizeForHumans)}})]):i("button",{staticClass:"btn btn-success",attrs:{title:"Add files to submit in this storage request",disabled:""}},[i("i",{staticClass:"fa fa-upload"}),e._v(" Submit\n                ")])])])]),e._v(" "),e.exceedsMaxSize?i("p",{staticClass:"text-danger"},[e._v("\n        You have selected more than the "),i("span",{domProps:{textContent:e._s(e.maxSizeForHumans)}}),e._v(" of storage available to you.\n    ")]):e._e(),e._v(" "),e.finished?i("p",{staticClass:"text-success"},[e._v("\n        The storage request has been submitted. You will be notified when it has been reviewed.\n    ")]):e._e(),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.hasItems,expression:"hasItems"}],staticClass:"panel panel-default"},[i("directory",{attrs:{path:"/",directory:e.rootDirectory,root:!0,removable:e.editable},on:{select:e.selectDirectory,unselect:e.unselectDirectory,"remove-directory":e.removeDirectory,"remove-file":e.removeFile}})],1)])}),[],!1,null,null,null);const o=e({components:{fileUploader:a.exports},data:function(){return{}},methods:{},created:function(){}},undefined,undefined,!1,null,null,null).exports;var l=e({props:{request:{type:Object,required:!0},expireDate:{type:Date,default:null}},computed:{pending:function(){return!this.request.expires_at},expired:function(){return Date.parse(this.request.expires_at)<Date.now()},expiresSoon:function(){return!(!this.request.expires_at||!this.expireDate)&&Date.parse(this.request.expires_at)<this.expireDate.getTime()},expiresTitle:function(){return"Expires ".concat(this.request.expires_at_for_humans)},filesCount:function(){return this.request.files?this.request.files.length:this.request.files_count||0}},methods:{handleSelect:function(){this.$emit("select",this.request)},handleDelete:function(){this.$emit("delete",this.request)},handleExtend:function(){this.expiresSoon&&this.$emit("extend",this.request)}}},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a",{staticClass:"list-group-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.handleSelect.apply(null,arguments)}}},[e._v("\n    #"),i("span",{domProps:{textContent:e._s(e.request.id)}}),e._v(" created "),i("span",{domProps:{textContent:e._s(e.request.created_at_for_humans)}}),e._v(" with "),i("span",{domProps:{textContent:e._s(e.request.files_count)}}),e._v(" file(s).\n    "),e.pending?i("span",[i("span",{staticClass:"label label-default",attrs:{title:"Waiting for review"}},[e._v("pending")])]):i("span",[e.expired?i("span",[i("span",{staticClass:"label label-danger",attrs:{title:"The storage request is expired and will be deleted soon"}},[e._v("expired")])]):i("span",[e.expiresSoon?i("span",{staticClass:"label label-warning",attrs:{title:e.expiresTitle}},[e._v("\n                expires "),i("span",{domProps:{textContent:e._s(this.request.expires_at_for_humans)}})]):i("span",{staticClass:"label label-success",attrs:{title:e.expiresTitle}},[e._v("\n                approved\n            ")])])]),e._v(" "),i("span",{staticClass:"pull-right"},[i("button",{staticClass:"btn btn-default btn-xs delete-button",attrs:{title:"Delete this storage request"},on:{click:function(t){return t.stopPropagation(),e.handleDelete.apply(null,arguments)}}},[i("i",{staticClass:"fa fa-trash"})]),e._v(" "),e.expiresSoon?i("button",{staticClass:"btn btn-default btn-xs",attrs:{title:"Extend this storage request"},on:{click:function(t){return t.stopPropagation(),e.handleExtend.apply(null,arguments)}}},[i("i",{staticClass:"fa fa-redo"})]):e._e()])])}),[],!1,null,null,null);var c=e({components:{listItem:l.exports},props:{requests:{type:Array,required:!0},expireDate:{type:Date,default:null}},computed:{noItems:function(){return 0===this.requests.length}},methods:{emitDelete:function(e){this.$emit("delete",e)},emitExtend:function(e){this.$emit("extend",e)},emitSelect:function(e){this.$emit("select",e)}}},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"list-group storage-request-list"},[e._l(e.requests,(function(t){return i("list-item",{key:t.id,attrs:{request:t,"expire-date":e.expireDate},on:{select:e.emitSelect,delete:e.emitDelete,extend:e.emitExtend}})})),e._v(" "),e.noItems?i("span",{staticClass:"list-group-item text-muted"},[e._v("\n        no storage requests\n    ")]):e._e()],2)}),[],!1,null,null,null);const u=e({mixins:[r],components:{requestList:c.exports},data:function(){return{requests:[],expireDate:0,usedQuotaBytes:0,availableQuotaBytes:0}},computed:{usedQuota:function(){return n(this.usedQuotaBytes)},availableQuota:function(){return n(this.availableQuotaBytes)},usedQuotaPercent:function(){return Math.round(this.usedQuotaBytes/this.availableQuotaBytes*100)}},methods:{handleSelect:function(e){},handleDelete:function(e){var t=this;confirm("Do you really want to delete the storage request with all files?")&&(this.startLoading(),i.delete({id:e.id},{}).then((function(){return t.handleDeleted(e)}),s).finally(this.finishLoading))},handleDeleted:function(e){var t=this.requests.indexOf(e);-1!==t&&this.requests.splice(t,1)},handleExtend:function(e){this.startLoading(),i.extend({id:e.id},{}).then(this.handleExtended,s).finally(this.finishLoading)},handleExtended:function(e){var t=this.requests.find((function(t){return t.id===e.body.id}));t.expires_at=e.body.expires_at,t.expires_at_for_humans=e.body.expires_at_for_humans}},created:function(){this.requests=biigle.$require("user-storage.requests"),this.expireDate=new Date(biigle.$require("user-storage.expireDate")),this.usedQuotaBytes=biigle.$require("user-storage.usedQuota"),this.availableQuotaBytes=biigle.$require("user-storage.availableQuota")}},undefined,undefined,!1,null,null,null).exports;biigle.$mount("create-storage-request-container",o),biigle.$mount("index-storage-request-container",u)},401:()=>{}},i={};function s(e){var r=i[e];if(void 0!==r)return r.exports;var n=i[e]={exports:{}};return t[e](n,n.exports,s),n.exports}s.m=t,e=[],s.O=(t,i,r,n)=>{if(!i){var a=1/0;for(u=0;u<e.length;u++){for(var[i,r,n]=e[u],o=!0,l=0;l<i.length;l++)(!1&n||a>=n)&&Object.keys(s.O).every((e=>s.O[e](i[l])))?i.splice(l--,1):(o=!1,n<a&&(a=n));if(o){e.splice(u--,1);var c=r();void 0!==c&&(t=c)}}return t}n=n||0;for(var u=e.length;u>0&&e[u-1][2]>n;u--)e[u]=e[u-1];e[u]=[i,r,n]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={355:0,392:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var r,n,[a,o,l]=i,c=0;if(a.some((t=>0!==e[t]))){for(r in o)s.o(o,r)&&(s.m[r]=o[r]);if(l)var u=l(s)}for(t&&t(i);c<a.length;c++)n=a[c],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(u)},i=self.webpackChunkbiigle_user_storage=self.webpackChunkbiigle_user_storage||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),s.O(void 0,[392],(()=>s(453)));var r=s.O(void 0,[392],(()=>s(401)));r=s.O(r)})();